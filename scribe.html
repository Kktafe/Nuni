<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Brief Me! - CRED-style Offline AI Summarizer">
    <meta name="theme-color" content="#000000">
    <title>Brief Me! | AI Analyst</title>
    
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQnJpZWYgTWUhIiwic2hvcnRfbmFtZSI6IkJyaWVmIE1lIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwMDAwMDAiLCJ0aGVtZV9jb2xvciI6IiMwMDAwMDAiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9jZG4taWNvbnMtcG5nLmZsaXRpY29uLmNvbS81MTIvNDMxOC80MzE4Mjg5LnBuZyIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9wbmciLCJwdXJwb3NlIjoiYW55IG1hc2thYmxlIn1dfQ==">

    <style>
        :root {
            --bg-black: #000000;
            --surface-grey: #121212;
            --border-grey: #2a2a2a;
            --cred-neon: #00FFC2; /* CRED signature teal */
            --text-white: #FFFFFF;
            --text-dim: #999999;
            --glass: rgba(255, 255, 255, 0.03);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-black);
            color: var(--text-white);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* CRED-style background gradient */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 80% 20%, #1a1a1a 0%, #000 60%);
            z-index: -1;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 60px;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -1px;
            text-transform: uppercase;
            border-left: 4px solid var(--cred-neon);
            padding-left: 12px;
        }

        .pwa-badge {
            background: var(--glass);
            border: 1px solid var(--border-grey);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--cred-neon);
            letter-spacing: 1px;
        }

        .main-card {
            background: var(--surface-grey);
            border: 1px solid var(--border-grey);
            border-radius: 2px; /* CRED uses sharp or slightly rounded corners */
            padding: 40px;
            position: relative;
            transition: border-color 0.3s ease;
        }

        .drop-zone {
            border: 1px dashed var(--border-grey);
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .drop-zone.drag-over {
            border-color: var(--cred-neon);
            background: rgba(0, 255, 194, 0.02);
        }

        .drop-zone h2 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .drop-zone p { color: var(--text-dim); }

        .btn-cred {
            background: var(--text-white);
            color: var(--bg-black);
            padding: 16px 32px;
            border: none;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s ease;
        }

        .btn-cred:hover { transform: scale(1.02); }

        .results-container {
            margin-top: 40px;
            display: none;
        }

        .analysis-block {
            border-bottom: 1px solid var(--border-grey);
            padding: 30px 0;
        }

        .analysis-block h3 {
            color: var(--cred-neon);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }

        .analysis-block div {
            font-size: 18px;
            line-height: 1.6;
            font-weight: 300;
        }

        .loading-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            backdrop-filter: blur(4px);
        }

        .loader {
            width: 40px;
            height: 2px;
            background: var(--cred-neon);
            animation: load 1.5s infinite linear;
        }

        @keyframes load {
            0% { transform: scaleX(0); transform-origin: left; }
            50% { transform: scaleX(1); transform-origin: left; }
            50.1% { transform: scaleX(1); transform-origin: right; }
            100% { transform: scaleX(0); transform-origin: right; }
        }

        input[type="file"] { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">BriefMe.</div>
            <div class="pwa-badge">OFFLINE SECURE</div>
        </header>

        <div class="main-card" id="app">
            <div class="drop-zone" id="dropZone">
                <h2>Upload Memo</h2>
                <p>Drag PDF or click to browse</p>
                <button class="btn-cred" onclick="document.getElementById('fileInput').click()">Browse Files</button>
            </div>
            <input type="file" id="fileInput" accept=".pdf,.txt">

            <div class="loading-overlay" id="loader">
                <div class="loader"></div>
                <p style="margin-top: 20px; font-size: 12px; letter-spacing: 2px;" id="statusText">INITIALIZING AI</p>
            </div>

            <div class="results-container" id="results">
                <div class="analysis-block">
                    <h3>Executive Summary</h3>
                    <div id="summary"></div>
                </div>
                <div class="analysis-block">
                    <h3>Risks Identified</h3>
                    <div id="risks"></div>
                </div>
                <button class="btn-cred" onclick="location.reload()" style="background:transparent; color:white; border:1px solid white">New Analysis</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';

        // Setup PDF.js Worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        class BriefMe {
            constructor() {
                this.model = null;
                this.init();
            }

            async init() {
                const dropZone = document.getElementById('dropZone');
                const fileInput = document.getElementById('fileInput');

                // Fix: Properly handle drag-and-drop prevention
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
                    dropZone.addEventListener(evt, (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                    });
                });

                dropZone.addEventListener('dragover', () => dropZone.classList.add('drag-over'));
                dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
                
                dropZone.addEventListener('drop', (e) => {
                    dropZone.classList.remove('drag-over');
                    const file = e.dataTransfer.files[0];
                    this.handleFile(file);
                });

                fileInput.addEventListener('change', (e) => this.handleFile(e.target.files[0]));
            }

            async handleFile(file) {
                if (!file) return;
                this.toggleLoader(true, 'EXTRACTING TEXT');
                
                try {
                    let text = '';
                    if (file.type === 'application/pdf') {
                        text = await this.extractPdf(file);
                    } else {
                        text = await file.text();
                    }
                    this.analyze(text);
                } catch (err) {
                    alert('Error: ' + err.message);
                    this.toggleLoader(false);
                }
            }

            async extractPdf(file) {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let content = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const text = await page.getTextContent();
                    content += text.items.map(s => s.str).join(' ') + ' ';
                }
                return content;
            }

            async analyze(text) {
                this.toggleLoader(true, 'LOADING AI MODEL');
                try {
                    if (!this.model) {
                        this.model = await pipeline('summarization', 'Xenova/distilbart-cnn-6-6');
                    }
                    
                    this.toggleLoader(true, 'GENERATING INSIGHTS');
                    const summary = await this.model(text.substring(0, 3000), {
                        max_length: 100,
                        min_length: 30
                    });

                    this.showResults(summary[0].summary_text, text);
                } catch (err) {
                    console.error(err);
                    this.toggleLoader(false);
                }
            }

            showResults(summary, fullText) {
                this.toggleLoader(false);
                document.getElementById('dropZone').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                document.getElementById('summary').innerText = summary;
                
                // Simple keyword extraction for risks
                const riskKeywords = ['risk', 'fail', 'concern', 'cost', 'legal'];
                const foundRisks = fullText.split(/[.!?]/)
                    .filter(s => riskKeywords.some(k => s.toLowerCase().includes(k)))
                    .slice(0, 3);
                
                document.getElementById('risks').innerHTML = foundRisks.length 
                    ? `<ul>${foundRisks.map(r => `<li>${r.trim()}.</li>`).join('')}</ul>`
                    : "No major risks detected in the sample.";
            }

            toggleLoader(show, text = '') {
                const loader = document.getElementById('loader');
                document.getElementById('statusText').innerText = text;
                loader.style.display = show ? 'flex' : 'none';
            }
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            const sw = `self.addEventListener('fetch', (e) => e.respondWith(fetch(e.request)));`;
            const blob = new Blob([sw], { type: 'text/javascript' });
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        }

        new BriefMe();
    </script>
</body>
</html>